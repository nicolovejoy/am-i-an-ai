(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{6249:function(){},8376:function(e,t,n){Promise.resolve().then(n.t.bind(n,3593,23)),Promise.resolve().then(n.bind(n,4362))},4362:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return c},a:function(){return u}});var s=n(7437),o=n(2265),i=n(9376),r=n(7492),a=n(571);let l=(0,o.createContext)(void 0),c=e=>{let{children:t}=e,[n,c]=(0,o.useState)(!1),[u,d]=(0,o.useState)(!0),[g,m]=(0,o.useState)(null),S=(0,i.useRouter)(),f=async()=>{try{let e=await r.Y.getCurrentUser();e?(c(!0),m(e)):(c(!1),m(null))}catch(e){c(!1),m(null)}finally{d(!1)}};return(0,o.useEffect)(()=>{f()},[]),(0,s.jsx)(l.Provider,{value:{isAuthenticated:n,isLoading:u,user:g,checkAuth:f,signOut:()=>{r.Y.signOut(),c(!1),m(null),a.F.getState().reset(),window.localStorage.clear(),window.sessionStorage.clear(),S.push("/auth/signin")}},children:t})},u=()=>{let e=(0,o.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7492:function(e,t,n){"use strict";n.d(t,{Y:function(){return i}});var s=n(3250);let o=new s.AM({UserPoolId:"us-east-1_ipC2hJAsT",ClientId:"6mvdodv3vud2pi5sv0oig920ne"}),i={signUp:async e=>{let{email:t,password:n}=e;return new Promise((e,i)=>{let r=[new s.KC({Name:"email",Value:t})];o.signUp(t,n,r,[],t=>{if(t){i({code:t.code||"UnknownError",message:t.message||"An unknown error occurred"});return}e()})})},confirmSignUp:async(e,t)=>new Promise((n,i)=>{new s.ws({Username:e,Pool:o}).confirmRegistration(t,!0,e=>{if(e){i({code:e.code||"UnknownError",message:e.message||"An unknown error occurred"});return}n()})}),signIn:async e=>{let{email:t,password:n}=e;return new Promise((e,i)=>{let r=new s.sD({Username:t,Password:n});new s.ws({Username:t,Pool:o}).authenticateUser(r,{onSuccess:()=>{e()},onFailure:e=>{i({code:e.code||"UnknownError",message:e.message||"An unknown error occurred"})}})})},getCurrentUser:async()=>new Promise(e=>{let t=o.getCurrentUser();if(!t){e(null);return}t.getSession((n,s)=>{if(n||!s||!s.isValid()){e(null);return}t.getUserAttributes((t,n)=>{var s,o;if(t||!n){e(null);return}let i=null===(s=n.find(e=>"email"===e.getName()))||void 0===s?void 0:s.getValue(),r=null===(o=n.find(e=>"sub"===e.getName()))||void 0===o?void 0:o.getValue();if(!i||!r){e(null);return}e({email:i,sub:r,role:"user"})})})}),signOut:()=>{let e=o.getCurrentUser();e&&e.signOut()},getIdToken:async()=>new Promise(e=>{let t=o.getCurrentUser();if(!t){e(null);return}t.getSession((t,n)=>{if(t||!n||!n.isValid()){e(null);return}e(n.getIdToken().getJwtToken())})})}},571:function(e,t,n){"use strict";n.d(t,{F:function(){return r}});var s=n(3011),o=n(6885);let i="wss://i5csamj3a8.execute-api.us-east-1.amazonaws.com/prod",r=(0,s.U)()((0,o.mW)((e,t)=>({connectionStatus:"disconnected",ws:null,sessionId:null,myIdentity:null,participants:[],messages:[],sessionStartTime:null,timeRemaining:null,isSessionActive:!1,isRevealed:!1,identityReveal:null,connect:()=>{var n;if((null===(n=t().ws)||void 0===n?void 0:n.readyState)!==WebSocket.OPEN){e({connectionStatus:"connecting"}),console.log("Attempting WebSocket connection to:",i);try{let n=new WebSocket(i);n.onopen=()=>{console.log("✅ WebSocket connected successfully"),e({connectionStatus:"connected",ws:n}),console.log("Sending join message..."),n.send(JSON.stringify({action:"join"}))},n.onmessage=e=>{try{let n=JSON.parse(e.data);switch(console.log("\uD83D\uDCE8 Received:",n),n.action){case"connected":t().handleConnect(n);break;case"message":t().handleMessage(n);break;case"participants":t().handleParticipantUpdate(n.participants);break;case"session_end":t().handleSessionEnd(n.reveal);break;default:console.log("Unknown message:",n)}}catch(e){console.error("Failed to parse message:",e)}},n.onerror=t=>{console.error("❌ WebSocket error:",t),console.error("WebSocket readyState:",n.readyState),e({connectionStatus:"error"})},n.onclose=n=>{console.log("\uD83D\uDD0C WebSocket disconnected. Code:",n.code,"Reason:",n.reason),e({connectionStatus:"disconnected",ws:null}),1e3!==n.code&&(console.log("\uD83D\uDD04 Retrying connection in 3 seconds..."),setTimeout(()=>{let e=t();"disconnected"===e.connectionStatus&&e.connect()},3e3))},setTimeout(()=>{n.readyState===WebSocket.CONNECTING&&(console.error("⏰ WebSocket connection timeout"),n.close(),e({connectionStatus:"error"}))},1e4)}catch(t){console.error("\uD83D\uDCA5 Failed to create WebSocket:",t),e({connectionStatus:"error"})}}},disconnect:()=>{let{ws:n}=t();n&&n.close(),e({connectionStatus:"disconnected",ws:null})},sendMessage:e=>{let{ws:n}=t();(null==n?void 0:n.readyState)===WebSocket.OPEN&&n.send(JSON.stringify({action:"message",content:e.trim()}))},handleConnect:t=>{e({myIdentity:t.identity,sessionId:t.sessionId,sessionStartTime:Date.now(),isSessionActive:!0,timeRemaining:600})},handleMessage:t=>{e(e=>({messages:[...e.messages,t]}))},handleParticipantUpdate:t=>{e({participants:t})},handleSessionEnd:t=>{e({isSessionActive:!1,isRevealed:!0,identityReveal:t,timeRemaining:0})},updateTimer:t=>{e({timeRemaining:t}),t<=0&&e({isSessionActive:!1})},reset:()=>{let{ws:n}=t();n&&n.close(),e({connectionStatus:"disconnected",ws:null,sessionId:null,myIdentity:null,participants:[],messages:[],sessionStartTime:null,timeRemaining:null,isSessionActive:!1,isRevealed:!1,identityReveal:null})}}),{name:"session-store"}))},3593:function(){},6885:function(e,t,n){"use strict";n.d(t,{mW:function(){return l}});let s=new Map,o=e=>{let t=s.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([e,t])=>[e,t.getState()])):{}},i=(e,t,n)=>{if(void 0===e)return{type:"untracked",connection:t.connect(n)};let o=s.get(n.name);if(o)return{type:"tracked",store:e,...o};let i={connection:t.connect(n),stores:{}};return s.set(n.name,i),{type:"tracked",store:e,...i}},r=(e,t)=>{if(void 0===t)return;let n=s.get(e);n&&(delete n.stores[t],0===Object.keys(n.stores).length&&s.delete(e))},a=e=>{var t,n;if(!e)return;let s=e.split("\n"),o=s.findIndex(e=>e.includes("api.setState"));if(o<0)return;let i=(null==(t=s[o+1])?void 0:t.trim())||"";return null==(n=/.+ (.+) .+/.exec(i))?void 0:n[1]},l=(e,t={})=>(n,s,l)=>{let u;let{enabled:d,anonymousActionType:g,store:m,...S}=t;try{u=(null==d||d)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(e){}if(!u)return e(n,s,l);let{connection:f,...p}=i(m,u,S),v=!0;l.setState=(e,t,i)=>{let r=n(e,t);if(!v)return r;let c=a(Error().stack),u=void 0===i?{type:g||c||"anonymous"}:"string"==typeof i?{type:i}:i;return void 0===m?null==f||f.send(u,s()):null==f||f.send({...u,type:`${m}/${u.type}`},{...o(S.name),[m]:l.getState()}),r},l.devtools={cleanup:()=>{f&&"function"==typeof f.unsubscribe&&f.unsubscribe(),r(S.name,m)}};let y=(...e)=>{let t=v;v=!1,n(...e),v=t},w=e(l.setState,s,l);if("untracked"===p.type?null==f||f.init(w):(p.stores[p.store]=l,null==f||f.init(Object.fromEntries(Object.entries(p.stores).map(([e,t])=>[e,e===p.store?w:t.getState()])))),l.dispatchFromDevtools&&"function"==typeof l.dispatch){let e=!1,t=l.dispatch;l.dispatch=(...n)=>{"__setState"!==n[0].type||e||(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),e=!0),t(...n)}}return f.subscribe(e=>{var t;switch(e.type){case"ACTION":if("string"!=typeof e.payload){console.error("[zustand devtools middleware] Unsupported action format");return}return c(e.payload,e=>{if("__setState"===e.type){if(void 0===m){y(e.state);return}1!==Object.keys(e.state).length&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);let t=e.state[m];if(null==t)return;JSON.stringify(l.getState())!==JSON.stringify(t)&&y(t);return}l.dispatchFromDevtools&&"function"==typeof l.dispatch&&l.dispatch(e)});case"DISPATCH":switch(e.payload.type){case"RESET":if(y(w),void 0===m)return null==f?void 0:f.init(l.getState());return null==f?void 0:f.init(o(S.name));case"COMMIT":if(void 0===m){null==f||f.init(l.getState());break}return null==f?void 0:f.init(o(S.name));case"ROLLBACK":return c(e.state,e=>{if(void 0===m){y(e),null==f||f.init(l.getState());return}y(e[m]),null==f||f.init(o(S.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return c(e.state,e=>{if(void 0===m){y(e);return}JSON.stringify(l.getState())!==JSON.stringify(e[m])&&y(e[m])});case"IMPORT_STATE":{let{nextLiftedState:n}=e.payload,s=null==(t=n.computedStates.slice(-1)[0])?void 0:t.state;if(!s)return;void 0===m?y(s):y(s[m]),null==f||f.send(null,n);break}case"PAUSE_RECORDING":return v=!v}return}}),w},c=(e,t)=>{let n;try{n=JSON.parse(e)}catch(e){console.error("[zustand devtools middleware] Could not parse the received json",e)}void 0!==n&&t(n)}},3011:function(e,t,n){"use strict";n.d(t,{U:function(){return l}});var s=n(2265);let o=e=>{let t;let n=new Set,s=(e,s)=>{let o="function"==typeof e?e(t):e;if(!Object.is(o,t)){let e=t;t=(null!=s?s:"object"!=typeof o||null===o)?o:Object.assign({},t,o),n.forEach(n=>n(t,e))}},o=()=>t,i={setState:s,getState:o,getInitialState:()=>r,subscribe:e=>(n.add(e),()=>n.delete(e))},r=t=e(s,o,i);return i},i=e=>e?o(e):o,r=e=>e,a=e=>{let t=i(e),n=e=>(function(e,t=r){let n=s.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return s.useDebugValue(n),n})(t,e);return Object.assign(n,t),n},l=e=>e?a(e):a}},function(e){e.O(0,[461,181,971,117,744],function(){return e(e.s=8376)}),_N_E=e.O()}]);